/*
 * --------------- By Display:inline -------------
 *      Modificado para el Proyecto PEI 2012000190 
 *                      Tatu Hu
 */
(function(e,t){function r(e){e.preventDefault()}function i(){if(object=e(this).data("custom-scroll")){if(object.hscrollbar)object.hscrollbar.animate({opacity:1});if(object.vscrollbar)object.vscrollbar.animate({opacity:1})}}function s(){if(object=e(this).data("custom-scroll")){if(object.hscrollbar)object.hscrollbar.animate({opacity:0});if(object.vscrollbar)object.vscrollbar.animate({opacity:0})}}function o(t,n,r,i){if(object=e(this).data("custom-scroll")){var s=object.mousewheel(r,i);if(s.x!=0||s.y!=0||!object.settings.continuousWheelScroll){t.preventDefault()}}}function u(t){e(this).refreshCustomScroll()}function a(t){var n=e(this),r=n.data("custom-scroll"),i=t.originalEvent.touches[0].pageX,s=t.originalEvent.touches[0].pageY,o,u;if(r&&!n.data("touch-scrolling")){o=function(e){e.preventDefault();n.data("touch-scrolling",true);var t=e.originalEvent.touches[0].pageX,o=e.originalEvent.touches[0].pageY;r.move(i-t,o-s,true);i=t;s=o};u=function(e){e.stopPropagation();n.off("touchmove",o);n.off("touchend touchcancel",u);n.removeData("touch-scrolling")};n.on("touchmove",o);n.on("touchend touchcancel",u)}}var n=e(t);e.fn.customScroll=function(t){var f=e.extend({},e.fn.customScroll.defaults,t);this.filter(".custom-scroll").refreshCustomScroll();this.not(".custom-scroll").addClass("custom-scroll").each(function(t){function x(e,t,n){var r=h,i=p;h=Math.max(0,Math.min(h+e,o[0].scrollWidth-o.innerWidth()));p=Math.max(0,Math.min(p-t,o[0].scrollHeight-o.innerHeight()));if(a.animate&&!n&&S){o.stop(true).animate({scrollLeft:h,scrollTop:p},{step:function(){o.refreshInnerTrackedElements()}})}else{o.scrollLeft(h).scrollTop(p).refreshInnerTrackedElements()}if(y&&e!=0){y()}if(b&&t!=0){b()}return{x:h-r,y:p-i}}function T(e,t,n){if(e!=0){e=e>0?Math.max(e,a.minWheelScroll):Math.min(e,-a.minWheelScroll)}if(t!=0){t=t>0?Math.max(t,a.minWheelScroll):Math.min(t,-a.minWheelScroll)}return x(e*a.speed,t*a.speed,n)}function N(){if(y){d.hide()}if(b){m.hide()}l=o[0].scrollWidth>o.innerWidth();c=o[0].scrollHeight>o.innerHeight();h=o.scrollLeft();p=o.scrollTop();if(y){w=!l&&a.autoHide;y()}if(b){E=!c&&a.autoHide;b()}}var o=e(this),u=o.is("ul, ol")?"li":"div",a=e.extend({},f,o.data("scroll-options")),l=o[0].scrollWidth>o.innerWidth(),c=o[0].scrollHeight>o.innerHeight(),h=o.scrollLeft(),p=o.scrollTop(),d,v,m,g,y=false,b=false,w=false,E=false,S=false;if(typeof a.padding!=="object"){a.padding={top:a.padding,right:a.padding,bottom:a.padding,left:a.padding}}a.padding=e.extend({top:0,right:0,bottom:0,left:0},a.padding);if(a.horizontal){d=e("<"+u+' class="custom-hscrollbar"></'+u+">").appendTo(o);v=e("<div></div>").appendTo(d);d.click(function(e){e.stopPropagation()});v.on("selectstart",r);y=function(){if(w){return}var e=o.width(),t=o.innerWidth(),n=a.vertical&&c&&!E?a.cornerWidth:0,r=(a.usePadding?e:t)-a.padding.top-a.padding.bottom-n,i=r>a.minScrollerSize*1.5?a.minScrollerSize:Math.round(r/1.5),s=r-i,u=Math.round(s*(e/o[0].scrollWidth))+i,f=Math.round((r-u)*(h/(o[0].scrollWidth-t)));d.show();d.stop(true)[a.animate&&S?"animate":"css"]({top:o.innerHeight()-(a.usePadding?o.parseCSSValue("padding-bottom")+a.padding.top:a.padding.bottom)-a.width+p+"px",left:(a.usePadding?o.parseCSSValue("padding-left")+a.padding.right:a.padding.left)+h+"px",width:r+"px",height:a.width+"px"});v.stop(true)[a.animate&&S?"animate":"css"]({left:f+"px",width:Math.round(u)+"px"})};v.on("mousedown",function(t){function s(t){var n=d.width()-v.innerWidth(),s=Math.max(0,Math.min(n,i+(t.pageX-r)));h=n>0?Math.round(s/n*(o[0].scrollWidth-o.innerWidth())):0;if(a.animate&&S){o.stop(true).animate({scrollLeft:h},{step:function(){e(this).refreshInnerTrackedElements()}})}else{o.stop(true).scrollLeft(h).refreshInnerTrackedElements()}if(y)y();if(b)b()}function u(){n.off("mousemove",s);n.off("mouseup",u)}var r=t.pageX,i=v.parseCSSValue("left");t.preventDefault();n.on("mousemove",s);n.on("mouseup",u)})}if(a.vertical){m=e("<"+u+' class="custom-vscrollbar"></'+u+">").appendTo(o);g=e("<div></div>").appendTo(m);m.click(function(e){e.stopPropagation()});g.on("selectstart",r);b=function(){if(E){return}var e=o.height(),t=o.innerHeight(),n=a.horizontal&&l&&!w?a.cornerWidth:0,r=(a.usePadding?e:t)-a.padding.top-a.padding.bottom-n,i=r>a.minScrollerSize*1.5?a.minScrollerSize:Math.round(r/1.5),s=r-i,u=s*(e/o[0].scrollHeight)+i,f=Math.round((r-u)*(p/(o[0].scrollHeight-t)));m.show();m.stop(true)[a.animate&&S?"animate":"css"]({top:(a.usePadding?o.parseCSSValue("padding-top")+a.padding.top:a.padding.top)+p+"px",left:o.innerWidth()-(a.usePadding?o.parseCSSValue("padding-right")+a.padding.right:a.padding.right)-a.width+h+"px",height:r+"px",width:a.width+"px"});g.stop(true)[a.animate&&S?"animate":"css"]({top:f+"px",height:Math.round(u)+"px"})};g.on("mousedown",function(t){function s(t){var n=m.height()-g.innerHeight(),s=Math.max(0,Math.min(n,i+(t.pageY-r)));p=n>0?Math.round(s/n*(o[0].scrollHeight-o.innerHeight())):0;if(a.animate&&S){o.stop(true).animate({scrollTop:p},{step:function(){e(this).refreshInnerTrackedElements()}})}else{o.stop(true).scrollTop(p).refreshInnerTrackedElements()}if(y)y();if(b)b()}function u(e){e.preventDefault();n.off("mousemove",s);n.off("mouseup",u)}var r=t.pageY,i=g.parseCSSValue("top");t.preventDefault();n.on("mousemove",s);n.on("mouseup",u)})}o.data("custom-scroll",{settings:a,hscrollbar:d,hscroller:v,vscrollbar:m,vscroller:g,refresh:N,refreshH:b,refreshV:b,move:x,mousewheel:T});N();if(a.showOnHover){if(d)d.css({opacity:0});if(m)m.css({opacity:0});o.on("mouseenter",i).on("mouseleave",s)}S=true}).on("mousewheel",o).on("scroll scrollsizechange",u).on("touchstart",a);return this};e.fn.removeCustomScroll=function(){this.filter(".custom-scroll").off("mousewheel",o).removeData("scroll-options").removeClass("custom-scroll").children(".custom-hscrollbar, .custom-vscrollbar").remove();return this};e.fn.hasCustomScroll=function(){return this.data("custom-scroll")?true:false};e.fn.refreshCustomScroll=function(){this.each(function(t){var n=e(this).data("custom-scroll");if(n){n.refresh()}});return this};e.fn.moveCustomScroll=function(t,n,r){this.each(function(i){var s=e(this).data("custom-scroll");if(s){s.move(t,n,r)}});return this};e.fn.scrollToReveal=function(){this.each(function(t){var n=e(this),r=n.parents(".custom-scroll");r.each(function(t){var r=e(this),i,s,o,u,a,f,l,c,h,p=0,d=0;u=r.data("custom-scroll");if(!u){return}o=r[0];s=n.offset();i=r.offset();s.top-=i.top+r.parseCSSValue("border-top-width");s.left-=i.left+r.parseCSSValue("border-left-width");a=n.outerWidth();f=n.outerHeight();h={top:u.settings.usePadding?r.parseCSSValue("padding-top"):0,right:u.settings.usePadding?r.parseCSSValue("padding-right"):0,bottom:u.settings.usePadding?r.parseCSSValue("padding-bottom"):0,left:u.settings.usePadding?r.parseCSSValue("padding-left"):0};l=r.innerWidth();c=r.innerHeight();if(s.left<h.left){p=h.left-s.left}else if(s.left+a>l-h.right){p=l-h.right-s.left-a}if(s.top<h.top){d=h.top-s.top}else if(s.top+f>c-h.bottom){d=c-h.bottom-s.top-f}if(p!==0||d!==0){u.move(p,d)}})});return this};e.fn.customScroll.defaults={horizontal:false,vertical:true,usePadding:false,padding:6,width:8,cornerWidth:10,minScrollerSize:30,minWheelScroll:.25,continuousWheelScroll:true,speed:48,animate:false,showOnHover:true,autoHide:true};e.template.addSetupFunction(function(e,t){this.findIn(e,t,".scrollable").customScroll();return this})})(jQuery,document)